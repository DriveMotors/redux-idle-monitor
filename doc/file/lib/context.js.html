<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/context.js | redux-idle-monitor API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/cchamberlain/redux-idle-monitor" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureActionDispatchers">configureActionDispatchers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createContext">createContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configure">configure</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureMiddleware">configureMiddleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureReducer">configureReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-activityAction">activityAction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-activityDetectionAction">activityDetectionAction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-configureResetDispatcher">configureResetDispatcher</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-configureStartDispatcher">configureStartDispatcher</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-configureStopDispatcher">configureStopDispatcher</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-createActionDispatchers">createActionDispatchers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-defineAction">defineAction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-resetHandler">resetHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-startHandler">startHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stopHandler">stopHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ACTIVITY">ACTIVITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ACTIVITY_DETECTION">ACTIVITY_DETECTION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-LIB_NAME">LIB_NAME</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ROOT_STATE_KEY">ROOT_STATE_KEY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getActions">getActions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getActiveEvents">getActiveEvents</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getLevel">getLevel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getThresholds">getThresholds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getUseFastState">getUseFastState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getUseLocalState">getUseLocalState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getUseWebRTCState">getUseWebRTCState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getUseWebSocketsState">getUseWebSocketsState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-createDispatcher">createDispatcher</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-createLogger">createLogger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-createMiddleware">createMiddleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-createReducer">createReducer</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/context.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { assert } from &apos;chai&apos;
import  { ROOT_STATE_KEY, ACTION_PREFIX } from &apos;./constants&apos;
import { getActions, getActiveEvents, getUseFastState, getUseLocalState, getUseWebRTCState, getUseWebSocketsState, getThresholds, getLevel } from &apos;./defaults&apos;

import { configureActivityEvent, configureStart, configureStop, configureReset, createActionDispatchers, activityAction, activityDetectionAction } from &apos;./actions&apos;

import configureContext from &apos;redux-addons/lib/context&apos;
import  { createLogger } from &apos;./log&apos;

const noop = () =&gt; {}
const sanitizeActions = actions =&gt; actions.map(x =&gt; [createActionName(x[0]), x[1]])
const createActionName = rawName =&gt; `${ACTION_PREFIX}_${rawName.toUpperCase().replace(/-+\s+/, &apos;_&apos;)}`


const validateContext = (libContext, appContext) =&gt; {
  assert.ok(libContext, &apos;must pass opts to validate&apos;)
  assert.ok(appContext, &apos;must pass opts to validate&apos;)

  const { libName, appName, libActions, appActions } = libContext
  const { activeEvents, useFastStore, useLocalStore, thresholds } = appContext

  assert.ok(libName, &apos;libName must exist&apos;)
  assert(typeof libName === &apos;string&apos;, &apos;libName opt must be a string&apos;)
  assert(libName.length &gt; 0, &apos;libName opt must not be empty&apos;)
  assert.ok(appName, &apos;appName must exist&apos;)
  assert(typeof appName === &apos;string&apos;, &apos;appName opt must be a string&apos;)
  assert(appName.length &gt; 0, &apos;appName opt must not be empty&apos;)


  assert.ok(appActions, &apos;actions must exist&apos;)
  assert(Array.isArray(appActions), &apos;actions must be an array&apos;)
  assert(appActions.every(x =&gt; Array.isArray(x)), &apos;actions must be an array of an array&apos;)
  assert(appActions.every(x =&gt; x.length === 2), &apos;every actions must have length 2&apos;)
  assert(appActions.every(x =&gt; typeof x[0] === &apos;string&apos;), &apos;every action must have first ordinal type string event name&apos;)
  assert(appActions.every(x =&gt; typeof x[1] === &apos;object&apos;), &apos;every action must have second ordinal type object&apos;)
  assert(appActions.every(x =&gt; typeof x[1].action !== &apos;undefined&apos;), &apos;every action must have second ordinal action function defined&apos;)
  assert(appActions.every(x =&gt; {
    const type = typeof x[1].timeoutMS
    return type === &apos;number&apos; || type === &apos;function&apos;
  }), &apos;every action must have second ordinal timeoutMS number or function defined&apos;)
  assert.ok(activeEvents, &apos;active events must exist&apos;)
}

const configureAppContext = libContext =&gt; {
  const { appName
        , libName
        , libActions
        , libActionMap
        , libActionNames
        , appActions
        , appActionMap
        , appActionNames
        , actions
        , actionMap
        , createActionType
        , typedLibActions
        , typedAppActions
        , libActionTypes
        , appActionTypes
        , typedActions
        , typedActionMap
        , getActionContextByName
        , getActionContextByType
        , getLibActionContextByOrdinal
        , getAppActionContextByOrdinal
        } = libContext
  return appOpts =&gt; {
    const { appActions, appActionMap, appActionNames, activeEvents, useFastStore, useLocalStore, thresholds } = appOpts

    const initialActionName = appActions[0][0]
    const initialAction = appActions[0][1].action
    const initialTimeoutMS = appActions[0][1].timeoutMS
    const initialLastEvent = { x: 0, y: 0 }
    const actionNames = appActions.map(x =&gt; x[0])


    const context = { getNextActionName: actionName =&gt; {
                        let hitCurrent = false
                        for(let current of appActionNames) {
                          if(hitCurrent)
                            return current
                          if(current === actionName)
                            hitCurrent = true
                        }
                      }
                    , getNextActionType: actionType =&gt; {
                        let hitCurrent = false
                        for(let current of appActionTypes) {
                          if(hitCurrent)
                            return current
                          if(current === actionType)
                            hitCurrent = true
                        }
                      }
                    , initialActionName
                    , initialAction
                    , initialTimeoutMS
                    , initialLastEvent
                    , getAction: actionName =&gt; appActionMap.get(actionName).action
                    , getTimeoutMS: actionName =&gt; appActionMap.get(actionName).timeoutMS
                    , activeEvents
                    , useFastStore
                    , useLocalStore
                    , thresholds
                    }
    return { ...context, childActions: createActionDispatchers(context) }
  }
}

const configureInitialState = libContext =&gt; appContext =&gt; {
  return  { actionName: appContext.initialActionName
          , isIdle: false
          , isPaused: false
          , lastActive: +new Date()
          , lastEvent: appContext.initialLastEvent
          //, timeoutID
          }
}

export default function createContext({ appName
                                      , appActions = getActions()
                                      , activeEvents = getActiveEvents()
                                      , useFastStore = getUseFastState()
                                      , useLocalStore = getUseLocalState()
                                      , useWebRTCState = getUseWebRTCState()
                                      , useWebSocketsState = getUseWebSocketsState()
                                      , thresholds = getThresholds()
                                      , level = getLevel()
                                      } = {}) {


  const libName = &apos;idlemonitor&apos;
  const libActions = [activityAction, activityDetectionAction]


  const libOpts = { libName, libActions, validateContext, configureAppContext, configureInitialState }
  const appOpts = { appName, appActions, activeEvents, useFastStore, useLocalStore, useWebRTCState, useWebSocketsState, thresholds, level }

  return configureContext(libOpts)(appOpts)





  /*
  if(process.env.NODE_ENV !== &apos;production&apos;)
    validate(opts)
  const actions = sanitizeActions(opts.libActions)
  const log = createLogger({ level })

  const actionMap = new Map(actions)

  const initialActionName = actions[0][0]
  const initialAction = actions[0][1].action
  const initialTimeoutMS = actions[0][1].timeoutMS
  const initialLastEvent = { x: 0, y: 0 }
  const actionNames = actions.map(x =&gt; x[0])

  const createFullState = ( { actionName = initialActionName
                            , isIdle = false
                            , isPaused = false
                            , lastActive = +new Date()
                            , lastEvent = initialLastEvent
                            , timeoutID
                            } = {}) =&gt; {
    return  { actionName, actionNames, isIdle, isPaused, lastActive, lastEvent, timeoutID }
  }

  const getNextActionName = actionName =&gt; {
    let hitCurrent = false
    for(let name of actions.map(x =&gt; x[0])) {
      if(hitCurrent)
        return name
      if(name === actionName)
        hitCurrent = true
    }
  }
  const context = { log
                  , get initialState() { return createFullState({ actionName: initialActionName }) }
                  , getNextActionName
                  , initialActionName
                  , initialAction
                  , initialTimeoutMS
                  , initialLastEvent
                  , activeEvents
                  , get actionNames() { return actionNames }
                  , getAction: actionName =&gt; actionMap.get(actionName).action
                  , getTimeoutMS: actionName =&gt; actionMap.get(actionName).timeoutMS
                  , get useFastStore() { return useFastStore }
                  , get useLocalStore() { return useLocalStore }
                  , get useWebRTCState() { return useWebRTCState }
                  , get useWebSocketsState() { return useWebSocketsState }
                  , get thresholds() { return thresholds }
                  }
  return { ...context, childActions: createActions(context) }
  */

}




</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.6)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
